<!-- Safari -- I just used copilot to help me with this one it was pretty simple although seamus may have made some alterations -->

<!--
    the reading list has been turned into the user 'onboarding checklist'. Ultimately it's functional but I think the final implementation 
    remained somewhat rough. I faced issues with the Django migrations on multiple occasions that led to leaving the associated model as 
    'readingMaterials' and the view as readingList. 

    The new functionality is a prebuilt checklist that users may interact with to earn badges for their profile. The checklist rewards the user
    with confetti for checking items off. It also features the added functionality of being able to click list items as well as the checkbox to improve
    the user interaction experience.
-->

{% extends 'base.html' %}
{% load static %}

{% block title %}Reading List{% endblock %}

{% block content %}
<style>
    .add-button {
        position: absolute;
        top: 5px;
        right: 10px;
        background-color: #5bc0de;
        color: white;
        padding: 10px;
        border: none;
        cursor: pointer;
            border-radius: 12%;
        
    }
    .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        border: 1px solid #ddd;
        background-color: white;
        display: none;  /* Hide the popup by default */
    }

    .popup.active {
        display: block;  /* Show the popup when it has the "active" class */
    }
    .read-item {
        position: relative;
    }

    .read-item::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 0;
        width: 100%;
        border-top: 4px solid black;
    }
    td {
        text-align: left;
        vertical-align: middle;
    }
    .update-form {
        display: flex;
        vertical-align: middle;
        height: 100%;
    }
</style>
<div class="container mt-4" >
    <!-- Title and headings -->
    <h2 class="text-center"><strong> Onboarding tasks </strong></h2>
    <table class="table mt-5 shadow" style="border-radius: 20px; overflow:hidden">
        <thead class="thead-dark">
            <tr>
                <th>To-do</th>
                <th>Done?</th>
            </tr>
        </thead>
        <tbody>
            <!-- loop through and display items -->
            {% for item in reading_list %} <!--The reading list needs to match what is put in the view exactly-->
            <tr class="{% if item.read %}table-secondary read-item{% else %}table-light{% endif %}">
            <tr class="{% if item.read %}table-secondary read-item{% else %}table-light{% endif %} clickable-row" data-item-id="{{ item.id }}">
                <!-- item title -->
                <td>{{ item.title }}</td>
                <td>
                    <form method="post" class="update-form">
                        <!-- csrf token for form input -->
                        {% csrf_token %}
                        <input type="hidden" name="item_id" value="{{ item.id }}">
                        <input type="hidden" name="form_type" value="update">
                        <div class="form-check">
                            <!-- render the checkbox  -->
                            <input class="form-check-input" type="checkbox" id="read_{{ item.id }}" name="read" {% if item.read %}checked{% endif %} onchange="this.form.submit()">
                            <label class="form-check-label" for="read_{{ item.id }}"></label>
                        </div>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <form method="POST" class="mb-4 mt-3">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="clear">
        <div class="row mb-4 mt-5">
            <div class="col-6 col-md-4">
                <!-- Add item button was here -->
            <div class="col-6 col-md-6 d-flex justify-content-end">
            </div>
        </div>
    </form>
    
    <!-- Add event popup made by copilot || project 1 comment --> 
    <div id="addPopup" class="popup">
        <form method="post" class="my-3">
            {% csrf_token %}
            {{ form.as_p }}
            <input type="hidden" name="form_type" value="add">
            <button type="submit" class="btn btn-primary rounded-pill">Confirm</button>
            <button type="button" class="btn btn-outline-danger rounded-pill ml-5" onclick="event.preventDefault(); togglePopup()">Close</button>
        </form>  
    </div>
    <script>
        function togglePopup() {
            var popup = document.getElementById("addPopup");
            popup.classList.toggle("active");
        }
    </script>

    <!-- confetti!!! -->

    <!-- check for the flag -->
    {% if show_confetti %}
    <script>
        //Wait till the page content is loaded
        document.addEventListener('DOMContentLoaded', function() {
            //shoot the confetti!
            confetti({
                particleCount: 200,
                spread: 180,
                origin: { y: 0.6 },
                drift: 0.6
            });
        });
    </script>
    {% endif %}

    <!-- clickable event items, connect the item to the checkbox -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Select our rows marked by clickable-row
            const rows = document.querySelectorAll('.clickable-row');
            // Add a click event listener to each row
            rows.forEach(row => {
                row.addEventListener('click', function (event) {
                    // Prevent the event from triggering if a form control is clicked
                    if (event.target.type !== 'checkbox' && event.target.tagName !== 'LABEL') {
                        // Toggle the checkbox
                        const itemId = this.getAttribute('data-item-id');
                        const checkbox = document.getElementById('read_' + itemId);
                        checkbox.checked = !checkbox.checked;
    
                        // Submit the form
                        checkbox.form.submit();
                    }
                });
            });
        });
    </script>
    

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</div>

{% load static %}

{% endblock %}
